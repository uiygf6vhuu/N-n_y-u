<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>K·ª∑ Ni·ªám T√¨nh Y√™u - [T√™n Ki·ªÉu Tr√°i Tim]</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f0f2f5;
            color: #333;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #dc143c;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .heart-container {
            position: relative;
            height: 350px; 
            width: 350px;
            animation: none; /* S·∫Ω ƒë∆∞·ª£c set b·∫±ng JS */
            margin-bottom: 40px;
        }

        /* Kh·ªëi ch√≠nh t·∫°o h√¨nh tr√°i tim b·∫±ng CSS */
        #heart-frame {
            position: relative;
            margin: auto;
            height: 100%;
            width: 100%;
        }
        #heart-frame:before, #heart-frame:after {
            content: '';
            position: absolute;
            background: var(--heart-color, #dc143c); 
            width: 175px; 
            height: 280px;
            border-top-left-radius: 87.5px;
            border-top-right-radius: 87.5px;
        }

        #heart-frame:before {
            left: 175px;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #heart-frame:after {
            left: 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }

        /* Animation c·ªßa tr√°i tim */
        @keyframes heart-beat-strong {
            0% { transform: scale(1); }
            30% { transform: scale(.9); }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes heart-beat-light {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        /* Kh·ªëi ch·ª©a ·∫£nh (Slideshow) */
        .image-slideshow {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 180px; 
            height: 180px;
            background: #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            overflow: hidden;
            z-index: 10;
        }

        .slideshow-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            position: absolute;
            /* Animation ph√≥ng to/thu nh·ªè theo nh·ªãp tim */
            animation: img-pulse 1s infinite; /* S·∫Ω ƒë∆∞·ª£c set b·∫±ng JS */
        }

        .slideshow-img.active {
            opacity: 1;
        }

        /* Keyframes cho ·∫£nh ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi nh·ªãp tim */
        @keyframes img-pulse-strong {
            0% { transform: scale(1); }
            30% { transform: scale(.95); } /* ·∫¢nh thu nh·ªè nh·∫π khi vi·ªÅn tr√°i tim n·ªü */
            60% { transform: scale(1.05); } /* ·∫¢nh ph√≥ng to nh·∫π khi vi·ªÅn tr√°i tim co */
            100% { transform: scale(1); }
        }
        @keyframes img-pulse-light {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .back-button {
            margin-top: 30px;
            padding: 12px 25px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
        }
        .back-button:hover {
            background: #357bd8;
        }

    </style>
</head>
<body>
    <h1>üíñ K·ª∑ Ni·ªám T√¨nh Y√™u üíñ</h1>
    
    <div class="heart-container" id="mainHeartContainer">
        <div class="image-slideshow" id="slideshow">
        </div>
        <div id="heart-frame"></div>
    </div>

    <button class="back-button" onclick="goBackToMain()">Tr·ªü V·ªÅ Trang Ch√≠nh</button>

    <script>
        let slideshowInterval;
        let currentImageIndex = 0;
        const intervalTime = 4000; // 4 gi√¢y
        let allImages = []; // Danh s√°ch ·∫£nh cho slideshow
        let sitePassword = localStorage.getItem('sitePassword'); // L·∫•y m·∫≠t kh·∫©u t·ª´ localStorage

        // Ki·ªÉm tra m·∫≠t kh·∫©u (ƒë∆°n gi·∫£n, kh√¥ng ph·∫£i x√°c th·ª±c ƒë·∫ßy ƒë·ªß)
        if (!sitePassword) {
            alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc ƒë·ªÉ xem c√°c k·ª∑ ni·ªám!');
            window.location.href = '/'; // Chuy·ªÉn v·ªÅ trang ƒëƒÉng nh·∫≠p
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadImages();
            
            // =========================================================
            // THAY ƒê·ªîI 3 D√íNG D∆Ø·ªöI ƒê√ÇY CHO T·ª™NG FILE TYM
            // =========================================================
            // V√≠ d·ª• cho index_tym1.html (Ki·ªÉu 1: M·∫°nh m·∫Ω - ƒê·ªè)
            const heartColor = '#dc143c'; 
            const heartAnimation = 'heart-beat-strong 1s infinite';
            const imageAnimation = 'img-pulse-strong 1s infinite'; 
            // ---------------------------------------------------------
            
            document.documentElement.style.setProperty('--heart-color', heartColor);
            document.getElementById('mainHeartContainer').style.animation = heartAnimation;
            document.querySelectorAll('.slideshow-img').forEach(img => {
                img.style.animation = imageAnimation;
            });
        });

        async function loadImages() {
            try {
                const imgResponse = await fetch('/api/love-image', {
                    headers: { 'Authorization': sitePassword }
                });
                
                if (imgResponse.ok) {
                    const imgData = await imgResponse.json();
                    
                    if (imgData.image) {
                        allImages = [imgData.image];
                    }
                }
            } catch (error) {
                console.error('L·ªói t·∫£i ·∫£nh Admin:', error);
            }
            
            // Th√™m c√°c ·∫£nh m·∫´u v√†o danh s√°ch ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng slideshow
            allImages.push(
                'https://picsum.photos/seed/love4/180/180',
                'https://picsum.photos/seed/love5/180/180',
                'https://picsum.photos/seed/love6/180/180'
            );

            // Lo·∫°i b·ªè tr√πng l·∫∑p v√† gi·ªØ 3 ·∫£nh ƒë·∫ßu ti√™n
            allImages = [...new Set(allImages)].slice(0, 3);
            createSlideshow();
        }

        function createSlideshow() {
            const slideshowEl = document.getElementById('slideshow');
            slideshowEl.innerHTML = '';
            
            allImages.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url;
                img.classList.add('slideshow-img');
                if (index === 0) {
                    img.classList.add('active');
                }
                slideshowEl.appendChild(img);
            });
            
            if (allImages.length > 1) {
                if (slideshowInterval) clearInterval(slideshowInterval);
                slideshowInterval = setInterval(nextImage, intervalTime);
            }
        }

        function nextImage() {
            const images = document.querySelectorAll('#slideshow .slideshow-img');
            if (images.length === 0) return;
            
            images[currentImageIndex].classList.remove('active');
            currentImageIndex = (currentImageIndex + 1) % images.length;
            images[currentImageIndex].classList.add('active');
        }

        function goBackToMain() {
            window.location.href = '/';
        }

    </script>
</body>
</html>
