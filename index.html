<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang T√¨nh Y√™u B√≠ M·∫≠t üíï</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Bi·∫øn CSS cho m√†u tr√°i tim */
        :root {
            --heart-color: #dc143c; /* M√†u m·∫∑c ƒë·ªãnh: ƒê·ªè */
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .password-input {
            font-size: 1.2em;
            padding: 15px;
            width: 100%;
            margin: 20px 0;
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            text-align: center;
        }
        
        /* C·∫•u tr√∫c Heart Container */
        .heart-container-wrapper {
            text-align: center;
            margin: 30px 0;
        }

        .heart-container {
            position: relative;
            width: 200px;
            height: 180px;
            margin: 40px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.5s ease-out;
            transform-origin: center;
        }

        .heart-border {
            position: absolute;
            width: 100px;
            height: 100px;
            background-color: transparent;
            border-radius: 50%;
            transform: rotate(-45deg);
            box-shadow: 0 0 0 5px var(--heart-color); /* S·ª≠ d·ª•ng bi·∫øn m√†u */
        }
        .heart-border:before, .heart-border:after {
            content: "";
            position: absolute;
            width: 100px;
            height: 100px;
            background-color: transparent;
            border-radius: 50%;
            box-shadow: 0 0 0 5px var(--heart-color); /* S·ª≠ d·ª•ng bi·∫øn m√†u */
        }
        .heart-border:before {
            top: -50px;
            left: 0;
        }
        .heart-border:after {
            left: 50px;
            top: 0;
        }

        .slideshow-img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            border: 3px solid white;
            transition: transform 0.5s;
        }
        
        /* LIST TIN NH·∫ÆN */
        .message-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ffafbd;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.7);
        }

        .message-list li {
            padding: 15px;
            border-bottom: 1px solid #ffc3a0;
            font-size: 1.1em;
        }

        .message-list li:last-child {
            border-bottom: none;
        }
        
        /* ANIMATIONS */
        /* Tym 1 & 3: M·∫°nh m·∫Ω */
        @keyframes heart-beat-strong {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes img-pulse-strong {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* Tym 2: Nh·∫π nh√†ng */
        @keyframes heart-beat-light {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes img-pulse-light {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body>

    <div id="loginScreen" class="login-container">
        <h1>üîë C·ªïng B√≠ M·∫≠t üîë</h1>
        <p>ƒê√¢y l√† trang c√° nh√¢n c·ªßa ch√∫ng ta, vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u:</p>
        <input type="password" id="sitePassword" class="password-input" placeholder="M·∫≠t kh·∫©u b√≠ m·∫≠t" autocomplete="off">
        <button class="btn" onclick="login()">ƒêƒÉng Nh·∫≠p</button>
    </div>

    <div id="mainContent" class="container" style="display:none;">
        <h1>Trang T√¨nh Y√™u B√≠ M·∫≠t üíï</h1>
        
        <div id="countdown" class="countdown">
            </div>

        <div class="heart-container-wrapper">
            <div class="heart-container" id="mainHeartContainer">
                <div class="heart-border" id="heartBorder"></div> 
                <img id="loveImage" class="slideshow-img" style="display:none;" alt="·∫¢nh k·ª∑ ni·ªám">
                <p id="noImage" class="no-content" style="display:none;">Ch∆∞a c√≥ ·∫£nh n√†o ƒë∆∞·ª£c t·∫£i l√™n!</p>
            </div>
        </div>

        <h2>üíå Tin Nh·∫Øn Y√™u Th∆∞∆°ng</h2>
        <ul id="messageList" class="message-list">
            </ul>
        
        <div class="navigation" style="margin-top: 50px; border-top: 1px solid #ffafbd; padding-top: 20px; display: flex; flex-direction: column; gap: 15px;">
            <h2>Kh√°m ph√° c√°c ki·ªÉu nh·ªãp ƒë·∫≠p ‚ù§Ô∏è</h2>
            <a href="#" onclick="showHeartAnimation('tym1'); return false;" class="btn" style="background: linear-gradient(45deg, #dc143c, #b3002d);">Nh·ªãp 1: M·∫°nh M·∫Ω (ƒê·ªè)</a>
            <a href="#" onclick="showHeartAnimation('tym2'); return false;" class="btn" style="background: linear-gradient(45deg, #ff69b4, #e84c8e);">Nh·ªãp 2: Bay Nh·∫π (H·ªìng)</a>
            <a href="#" onclick="showHeartAnimation('tym3'); return false;" class="btn" style="background: linear-gradient(45deg, #9370db, #7b59bf);">Nh·ªãp 3: C·ªï ƒêi·ªÉn (T√≠m)</a>
        </div>
        
        <div class="navigation" style="margin-top: 30px;">
            <a href="game.html" class="btn">Ch∆°i Game T√¨nh Y√™u</a>
            <button class="btn" onclick="logout()">ƒêƒÉng Xu·∫•t</button>
        </div>
    </div>

    <script>
        // --- C√ÅC H·∫∞NG S·ªê C·∫§U H√åNH ---
        const TARGET_DATE = new Date("2024-03-08T00:00:00").getTime(); // Thay ƒë·ªïi ng√†y n√†y!

        let isAuthenticated = false;
        let sitePassword = localStorage.getItem('sitePassword');

        // ========================================================
        // üéØ H√ÄM CH√çNH: THAY ƒê·ªîI HI·ªÜU ·ª®NG TR√ÅI TIM
        // ========================================================
        function showHeartAnimation(style) {
            const heartContainer = document.getElementById('mainHeartContainer');
            const loveImage = document.getElementById('loveImage');
            const noImage = document.getElementById('noImage');

            let color, heartAnim, imageAnim;

            if (style === 'tym1') {
                color = '#dc143c'; // ƒê·ªè
                heartAnim = 'heart-beat-strong 1s infinite';
                imageAnim = 'img-pulse-strong 1s infinite';
            } else if (style === 'tym2') {
                color = '#ff69b4'; // H·ªìng
                heartAnim = 'heart-beat-light 2s infinite linear';
                imageAnim = 'img-pulse-light 2s infinite linear';
            } else if (style === 'tym3') {
                color = '#9370db'; // T√≠m
                heartAnim = 'heart-beat-strong 1.3s infinite';
                imageAnim = 'img-pulse-strong 1.3s infinite';
            } else {
                return; // Kh√¥ng l√†m g√¨ n·∫øu style kh√¥ng h·ª£p l·ªá
            }

            // 1. √Åp d·ª•ng m√†u v√† animation
            document.documentElement.style.setProperty('--heart-color', color);
            heartContainer.style.animation = heartAnim;
            loveImage.style.animation = imageAnim;
            
            // 2. C·∫≠p nh·∫≠t m√†u cho th√¥ng b√°o n·∫øu ch∆∞a c√≥ ·∫£nh
            noImage.style.color = color;
        }


        // --- LOGIC ƒêƒÇNG NH·∫¨P V√Ä LOAD D·ªÆ LI·ªÜU ---

        async function login() {
            const passwordInput = document.getElementById('sitePassword');
            const password = passwordInput.value;

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password, type: 'site' })
                });

                const data = await response.json();

                if (data.success) {
                    isAuthenticated = true;
                    sitePassword = password;
                    localStorage.setItem('sitePassword', password);
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                    loadContent();
                } else {
                    alert('Sai m·∫≠t kh·∫©u. H√£y th·ª≠ l·∫°i!');
                }
            } catch (error) {
                alert('L·ªói k·∫øt n·ªëi server: ' + error.message);
            }
        }

        function logout() {
            isAuthenticated = false;
            sitePassword = '';
            localStorage.removeItem('sitePassword');
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('sitePassword').value = '';
        }
        
        // C·∫≠p nh·∫≠t ƒë·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = TARGET_DATE - now;
            const countdownEl = document.getElementById('countdown');

            if (distance < 0) {
                countdownEl.innerHTML = "üéâ **K·ª∑ ni·ªám c·ªßa ch√∫ng ta!** üéâ";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            countdownEl.innerHTML = `**üíå ${days}** ng√†y **${hours}** gi·ªù **${minutes}** ph√∫t **${seconds}** gi√¢y`;
        }

        // T·∫£i ·∫£nh v√† tin nh·∫Øn
        async function loadContent() {
            if (!sitePassword) return;

            try {
                // 1. T·∫£i ·∫£nh
                const imgResponse = await fetch('/api/love-image', {
                    headers: { 'Authorization': sitePassword }
                });
                
                const loveImage = document.getElementById('loveImage');
                const noImage = document.getElementById('noImage');

                if (imgResponse.ok) {
                    const imgData = await imgResponse.json();
                    
                    if (imgData.image) {
                        loveImage.src = imgData.image;
                        loveImage.style.display = 'block';
                        noImage.style.display = 'none';
                    } else {
                        loveImage.style.display = 'none';
                        noImage.style.display = 'block';
                    }
                }

                // √Åp d·ª•ng ki·ªÉu m·∫∑c ƒë·ªãnh khi load xong
                showHeartAnimation('tym1'); 

                // 2. T·∫£i tin nh·∫Øn
                const msgResponse = await fetch('/api/messages', {
                    headers: { 'Authorization': sitePassword }
                });

                if (msgResponse.ok) {
                    const data = await msgResponse.json();
                    const container = document.getElementById('messageList');
                    container.innerHTML = '';
                    
                    if (data.messages && data.messages.length > 0) {
                        data.messages.reverse().forEach(msg => { // Hi·ªÉn th·ªã tin nh·∫Øn m·ªõi nh·∫•t tr∆∞·ªõc
                            const li = document.createElement('li');
                            li.textContent = `üí¨ ${msg}`;
                            container.appendChild(li);
                        });
                    } else {
                        container.innerHTML = '<p class="no-content">Ch∆∞a c√≥ tin nh·∫Øn y√™u th∆∞∆°ng n√†o ƒë∆∞·ª£c g·ª≠i.</p>';
                    }
                }
            } catch (error) {
                console.error('L·ªói t·∫£i d·ªØ li·ªáu:', error);
                // N·∫øu l·ªói 401 (Unauthorized), chuy·ªÉn h∆∞·ªõng v·ªÅ ƒëƒÉng nh·∫≠p
                if (error.message.includes('401')) {
                    logout();
                    alert('Phi√™n l√†m vi·ªác h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
                }
            }
        }


        // --- KH·ªûI T·∫†O ---
        document.addEventListener('DOMContentLoaded', () => {
            // Thi·∫øt l·∫≠p ƒë·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c
            updateCountdown();
            setInterval(updateCountdown, 1000);

            // T·ª± ƒë·ªông th·ª≠ ƒëƒÉng nh·∫≠p n·∫øu ƒë√£ c√≥ m·∫≠t kh·∫©u trong localStorage
            if (sitePassword) {
                document.getElementById('sitePassword').value = sitePassword; // ƒëi·ªÅn l·∫°i m·∫≠t kh·∫©u
                login();
            } else {
                 document.getElementById('loginScreen').style.display = 'block';
            }
        });

        // Enter ƒë·ªÉ ƒëƒÉng nh·∫≠p
        document.getElementById('sitePassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>
