<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Bí Mật Tình Yêu</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Chào mừng đến với trang bí mật!</h1>
    
    <div id="auth-section">
        <input type="password" id="sitePassword" placeholder="Nhập mật khẩu trang chính">
        <button onclick="loginSite()">Truy Cập</button>
        <p id="authMessage" style="color: red;"></p>
    </div>

    <div id="main-content" style="display: none;">
        <h2>Dành cho người đặc biệt của tôi ❤️</h2>
        
        <img 
            id="loveImage" 
            class="image-animated" 
            src="https://picsum.photos/seed/defaultlove/400/400" 
            alt="Ảnh tình yêu"
        />

        <h3>Tin Nhắn Gần Đây</h3>
        <div id="messages-container">
            <p>Đang tải tin nhắn...</p>
        </div>
        
        <h4>Gửi Tin Nhắn Mới</h4>
        <input type="text" id="newMessage" placeholder="Tin nhắn của bạn (tối đa 500 ký tự)">
        <button onclick="postMessage()">Gửi</button>
        <p id="postMessageResult"></p>
    </div>

    <script src="app.js"></script>
    <script>
        // Mật khẩu Admin: newadmin123
        // Mật khẩu Site: tinhyeu123
        
        // Đoạn JS cơ bản để test API/Xác thực. Bạn cần phát triển app.js chi tiết hơn.
        let siteToken = ''; // Lưu mật khẩu đã nhập

        async function loginSite() {
            const password = document.getElementById('sitePassword').value;
            
            // Thử gọi API messages để xác thực
            const response = await fetch('/api/messages', {
                method: 'GET',
                headers: {
                    'Authorization': password
                }
            });

            const authMsg = document.getElementById('authMessage');
            if (response.ok) {
                siteToken = password; // Lưu mật khẩu thành công
                authMsg.textContent = 'Truy cập thành công!';
                authMsg.style.color = 'green';
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                loadContent(); // Tải nội dung chính
            } else {
                authMsg.textContent = 'Mật khẩu không đúng.';
                authMsg.style.color = 'red';
            }
        }

        async function loadContent() {
            // Tải Tin nhắn
            const msgResponse = await fetch('/api/messages', {
                headers: { 'Authorization': siteToken }
            });
            if (msgResponse.ok) {
                const data = await msgResponse.json();
                const container = document.getElementById('messages-container');
                container.innerHTML = data.messages.map(m => `<p>${m}</p>`).join('');
            }

            // Tải Ảnh
            const imgResponse = await fetch('/api/love-image', {
                headers: { 'Authorization': siteToken }
            });
            if (imgResponse.ok) {
                const data = await imgResponse.json();
                document.getElementById('loveImage').src = data.image;
            }
        }

        async function postMessage() {
            const message = document.getElementById('newMessage').value;
            const today = new Date().toISOString().split('T')[0];
            
            const response = await fetch('/api/messages-with-date', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': siteToken 
                },
                body: JSON.stringify({ date: today, message })
            });

            const resultMsg = document.getElementById('postMessageResult');
            if (response.ok) {
                resultMsg.textContent = 'Tin nhắn đã được gửi!';
                resultMsg.style.color = 'green';
                document.getElementById('newMessage').value = '';
                loadContent(); // Tải lại tin nhắn
            } else {
                const errorData = await response.json();
                resultMsg.textContent = 'Lỗi gửi tin: ' + (errorData.error || 'Unknown error');
                resultMsg.style.color = 'red';
            }
        }
    </script>
</body>
</html>
